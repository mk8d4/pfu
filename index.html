<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pub Finder Util</title>
  <style>
    :root{
      --card-bg: rgba(255,255,255,0.95);
      --text:#1f2937; --muted:#6b7280;
      --primary:#667eea; --primary-hover:#5a67d8;
      --btn-text:#ffffff; --field-border:#d1d5db;
      --grad1:#667eea; --grad2:#764ba2;
    }
    body.dark{
      --card-bg: rgba(17,24,39,0.9);
      --text:#f3f4f6; --muted:#9ca3af;
      --primary:#8b5cf6; --primary-hover:#7c3aed;
      --btn-text:#f9fafb; --field-border:#374151;
      --grad1:#0f172a; --grad2:#383a83;
    }
    *{box-sizing:border-box}
    body{margin:0;padding:0;font-family:Arial, sans-serif;
      background:linear-gradient(135deg,var(--grad1),var(--grad2));
      display:flex;align-items:center;justify-content:center;min-height:100vh;color:var(--text)}
    .container{background:var(--card-bg);border-radius:16px;padding:2rem;max-width:620px;width:92%;
      box-shadow:0 8px 16px rgba(0,0,0,.25);position:relative}
    h1{margin:0 0 1rem;font-size:1.6rem}

    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}
    .theme-toggle{background:transparent;border:1px solid var(--field-border);
      border-radius:999px;padding:.4rem .7rem;cursor:pointer;color:var(--text)}

    .radio-group{display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:.75rem}
    .radio-group label{font-size:1rem}

    .mode-group{display:flex;justify-content:flex-start;margin:.25rem 0 12px}
    .mode-btn{padding:.6rem .9rem;border-radius:999px;border:1px solid var(--field-border);
      background:#1f2937;color:#fff;cursor:pointer;font-weight:600}
    body.dark .mode-btn{background:#111827;color:#fff;border-color:#374151}

    .input-wrap{display:flex;justify-content:center}
    #searchInput{width:60%;min-width:260px;max-width:420px;padding:.75rem;margin-bottom:1rem;
      border:1px solid var(--field-border);border-radius:8px;font-size:1rem;background:transparent;color:var(--text)}

    .primary{width:100%;padding:.75rem;margin-bottom:1rem;border:none;cursor:pointer;
      background-color:var(--primary);color:var(--btn-text);border-radius:8px;font-size:1rem;transition:background-color .25s}
    .primary:hover{background-color:var(--primary-hover)}

/* Default buttons (Find, New Search) */
button { width:100%; padding:.75rem; margin-bottom:1rem; border:none; cursor:pointer; background-color:#667eea; color:#fff; border-radius:8px; font-size:1rem; transition:background-color .3s ease; }
button:hover { background-color:#5a67d8; }



/* Outcome buttons row */
.outcome-row { display:flex; gap:.5rem; justify-content:center; align-items:center; margin:.25rem auto .5rem; width:max-content; }
.icon-btn { width:auto; padding:.45rem .6rem; margin:0; background:#f8fafc; color:#333; border:1px solid #d1d5db; border-radius:8px; font-size:1.1rem; line-height:1; }
.icon-btn:hover { background:#eef2ff; border-color:#667eea; }

    /* Switches */
.controls{display:flex;gap:1rem;flex-wrap:wrap;align-items:center;margin:.5rem 0 1rem}
.switch-field{display:flex;align-items:center;gap:.6rem}
.switch-field .label{font-size:.95rem;color:var(--muted)}
.switch{position:relative;display:inline-flex;align-items:center}
.switch input{appearance:none;width:42px;height:24px;border-radius:999px;background:#e5e7eb;outline:none;cursor:pointer;transition:background .2s;border:1px solid var(--field-border)}
.switch input:checked{background:#22c55e;border-color:#22c55e}
.switch .thumb{position:absolute;left:2px;top:2px;width:20px;height:20px;background:#fff;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,.2);transition:transform .2s}
.switch input:checked + .thumb{transform:translateX(18px)}
.switch .legend{margin-left:.5rem;font-size:.9rem;color:var(--muted)}
.legend b{color:var(--text)}

/* Material search with inline Find button */
.search-shell{position:relative;width:60%;min-width:260px;max-width:420px}
#searchInput{width:100%;padding:.9rem 3rem .9rem 1rem;border:1px solid var(--field-border);border-radius:999px;font-size:1rem;background:#fff;color:#111827}
body.dark #searchInput{background:#0b1220;color:#e5e7eb;border-color:#273043}
#find-btn{position:absolute;right:6px;top:50%;transform:translateY(-50%);width:40px;height:40px;border:none;border-radius:999px;background:var(--primary);color:var(--btn-text);display:grid;place-items:center;cursor:pointer;box-shadow:0 8px 16px rgba(0,0,0,.25)}
#find-btn:hover{background:var(--primary-hover)}

@media (max-width:640px){
  .search-shell{width:100%}
}


#msg { color:red; min-height:1.25rem; }
#qr-container { margin-top:1rem; display:none; }
#qr-code { width:150px; height:150px; margin:0 auto; }
#new-search { margin-top:8px; background-color:#6b7280; width:auto; padding:.5rem .8rem; }
#new-search:hover { background-color:#4b5563; }

    #msg{color:#ef4444;min-height:1.25rem}
    #qr-container{margin-top:1rem;display:none}
    #qr-code{width:150px;height:150px;margin:0 auto;display:block}

    .actions{display:grid;gap:.5rem}
    .footer-actions{display:flex;justify-content:flex-end;margin-top:.25rem}
    #new-search{width:auto;padding:.5rem .8rem;border:none;cursor:pointer;background-color:#6b7280;color:#fff;border-radius:8px;font-size:.9rem}
    #new-search:hover{background-color:#4b5563}

    @media (max-width:640px){
      .container{padding:1.25rem}
      h1{font-size:1.25rem}
      #searchInput{width:100%}
      .radio-group{justify-content:space-between}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <h1>Pub Finder Util</h1>
      <button id="theme-toggle" class="theme-toggle" aria-pressed="false" title="Toggle theme">🌙 Dark</button>
    </div>

   <!-- Switches: Language + Mode -->
<div class="controls">
  <div class="switch-field" aria-label="Language">
    <span class="label">Language</span>
    <label class="switch">
      <input type="checkbox" id="lang-switch" aria-label="Language toggle (EN ⇄ ASL)">
      <span class="thumb"></span>
    </label>
    <span class="legend"><b>EN</b> / ASL</span>
  </div>

  <div class="switch-field mode-group" aria-label="Search mode">
    <span class="label">Mode</span>
    <label class="switch">
      <input type="checkbox" id="mode-switch" aria-label="Mode toggle (Publication ⇄ Bible)">
      <span class="thumb"></span>
    </label>
    <span class="legend"><b>Publication</b> / Bible</span>
  </div>
</div>


    <!-- Single Search Input -->
  <div class="input-wrap">
  <div class="search-shell">
    <input id="searchInput" type="text" placeholder="e.g. lff • w14 8/15 • w16.01" autofocus>
    <button id="find-btn" title="Find" aria-label="Find">🔎</button>
  </div>
</div>


    <div id="msg"></div>

   <div id="extra-buttons" class="actions" style="display:none;">
  <div class="outcome-row">
    <button id="toc-btn" class="icon-btn" title="Table of Contents" aria-label="Table of Contents">📑</button>
    <button id="qr-btn" class="icon-btn" title="QR Code" aria-label="QR Code">🔳</button>
    <button id="share-btn" class="icon-btn" title="Share Link" aria-label="Share Link">🔗</button>
  </div>
  <div id="qr-container"><canvas id="qr-code"></canvas></div>
  <div class="footer-actions">
    <button id="new-search" style="display:none;">New Search</button>
  </div>
</div>


  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
  <script>
    const msgEl = document.getElementById('msg');
    const findBtn = document.getElementById('find-btn');
    const tocBtn = document.getElementById('toc-btn');
    const qrBtn = document.getElementById('qr-btn');
    const shareBtn = document.getElementById('share-btn');
    const newSearchBtn = document.getElementById('new-search');
    const extraButtons = document.getElementById('extra-buttons');
    const qrContainer = document.getElementById('qr-container');
    const qrCanvas = document.getElementById('qr-code');

    const searchInput = document.getElementById('searchInput');
    const themeToggleBtn = document.getElementById('theme-toggle');
const langSwitch = document.getElementById('lang-switch');
const modeSwitch = document.getElementById('mode-switch');

    let currentUrl = null;
    let mode = 'pub'; // 'pub' | 'bible'

    // THEME
    function applyTheme(t){
      document.body.classList.toggle('dark', t==='dark');
      themeToggleBtn.textContent = t==='dark' ? '☀️ Light' : '🌙 Dark';
      themeToggleBtn.setAttribute('aria-pressed', String(t==='dark'));
      localStorage.setItem('pfu_theme', t);
    }
    const savedTheme = localStorage.getItem('pfu_theme') || 'light';
    applyTheme(savedTheme);
    themeToggleBtn.addEventListener('click', ()=>{
      const next = document.body.classList.contains('dark') ? 'light' : 'dark';
      applyTheme(next);
    });

   function getSelectedLanguage(){
  return langSwitch && langSwitch.checked ? 'ase' : 'en';
}


    function pad2(n){ return String(n).padStart(2,'0'); }
    function pad3(n){ return String(n).padStart(3,'0'); }

    // Bible book codes (comprehensive keys)
    const BOOK_CODES = {
      'genesis':'010','gen':'010','ge':'010','gn':'010',
      'exodus':'020','exo':'020','ex':'020',
      'leviticus':'030','lev':'030','le':'030',
      'numbers':'040','num':'040','nu':'040','nm':'040',
      'deuteronomy':'050','deut':'050','dt':'050','de':'050',
      'joshua':'060','jos':'060','jo':'060',
      'judges':'070','judg':'070','jdg':'070','jg':'070',
      'ruth':'080','ru':'080',
      '1 samuel':'090','1sam':'090','1 sa':'090','1sm':'090','i samuel':'090','1samuel':'090',
      '2 samuel':'100','2sam':'100','2 sa':'100','2sm':'100','ii samuel':'100','2samuel':'100',
      '1 kings':'110','1ki':'110','1kgs':'110','i kings':'110','1kings':'110',
      '2 kings':'120','2ki':'120','2kgs':'120','ii kings':'120','2kings':'120',
      '1 chronicles':'130','1ch':'130','i chronicles':'130','1chronicles':'130',
      '2 chronicles':'140','2ch':'140','ii chronicles':'140','2chronicles':'140',
      'ezra':'150','ezr':'150',
      'nehemiah':'160','neh':'160',
      'esther':'170','est':'170','es':'170',
      'job':'180','jb':'180',
      'psalms':'190','psalm':'190','ps':'190','psa':'190',
      'proverbs':'200','prov':'200','pr':'200','prv':'200',
      'ecclesiastes':'210','eccl':'210','ecc':'210','ec':'210',
      'song of solomon':'220','song of songs':'220','song':'220','sos':'220','canticles':'220','cant':'220',
      'isaiah':'230','isa':'230','is':'230',
      'jeremiah':'240','jer':'240','je':'240',
      'lamentations':'250','lam':'250','la':'250',
      'ezekiel':'260','ezek':'260','eze':'260','ez':'260',
      'daniel':'270','dan':'270','da':'270',
      'hosea':'280','hos':'280','ho':'280',
      'joel':'290','joe':'290','jl':'290',
      'amos':'300','am':'300',
      'obadiah':'310','obad':'310','ob':'310',
      'jonah':'320','jon':'320','jh':'320',
      'micah':'330','mic':'330','mi':'330',
      'nahum':'340','nah':'340','na':'340',
      'habakkuk':'350','hab':'350','hb':'350',
      'zephaniah':'360','zeph':'360','zep':'360','zp':'360',
      'haggai':'370','hag':'370','hg':'370',
      'zechariah':'380','zech':'380','zec':'380','zc':'380',
      'malachi':'390','mal':'390','ml':'390',
      'matthew':'400','matt':'400','mt':'400',
      'mark':'410','mk':'410',
      'luke':'420','lk':'420','lu':'420',
      'john':'430','jn':'430','joh':'430',
      'acts':'440','ac':'440',
      'romans':'450','rom':'450','ro':'450',
      '1 corinthians':'460','1cor':'460','i corinthians':'460','1 cor':'460','1corinthians':'460',
      '2 corinthians':'470','2cor':'470','ii corinthians':'470','2 cor':'470','2corinthians':'470',
      'galatians':'480','gal':'480','ga':'480',
      'ephesians':'490','eph':'490','ep':'490',
      'philippians':'500','phil':'500','php':'500','ph':'500',
      'colossians':'510','col':'510','co':'510',
      '1 thessalonians':'520','1thess':'520','1 th':'520','i thessalonians':'520','1thessalonians':'520',
      '2 thessalonians':'530','2thess':'530','2 th':'530','ii thessalonians':'530','2thessalonians':'530',
      '1 timothy':'540','1tim':'540','i timothy':'540','1 tim':'540','1timothy':'540',
      '2 timothy':'550','2tim':'550','ii timothy':'550','2 tim':'550','2timothy':'550',
      'titus':'560','tit':'560',
      'philemon':'570','philem':'570','phm':'570','pm':'570',
      'hebrews':'580','heb':'580','hb':'580',
      'james':'590','jas':'590','jm':'590',
      '1 peter':'600','1pet':'600','i peter':'600','1 pe':'600','1peter':'600',
      '2 peter':'610','2pet':'610','ii peter':'610','2 pe':'610','2peter':'610',
      '1 john':'620','1jn':'620','i john':'620','1 jn':'620','1john':'620',
      '2 john':'630','2jn':'630','ii john':'630','2 jn':'630','2john':'630',
      '3 john':'640','3jn':'640','iii john':'640','3 jn':'640','3john':'640',
      'jude':'650','jud':'650','jd':'650',
      'revelation':'660','rev':'660','re':'660','apocalypse':'660'
    };

    function parseBibleRef(input){
  const s = input.trim().replace(/\s+/g,' ');
  const m = /^([1-3]?\s?[A-Za-z ]+?)\s+(\d+)(?::(\d+)(?:-(\d+))?)?$/i.exec(s);
  if(!m) return null;
  const bookKey = m[1].toLowerCase().trim();
  const bookCode = BOOK_CODES[bookKey];
  if(!bookCode) return null;
  const pad2 = n => String(n).padStart(2,'0');
  const pad3 = n => String(n).padStart(3,'0');
  const chap  = parseInt(m[2],10);
  const v1    = m[3] ? parseInt(m[3],10) : null;
  const v2    = m[4] ? parseInt(m[4],10) : null;

  const left = bookCode + pad2(chap) + pad3(v1 ?? 0);
  if (v1 === null) return left; // whole chapter e.g., 40006000
  if (v2){
    const right = bookCode + pad2(chap) + pad3(v2);
    return left + '-' + right;  // range e.g., 40006033-40006034
  }
  return left; // single verse e.g., 40006033
}

    function parsePeriodical(input){
      const s = input.trim();
      let m = /^([wg])(\d{2})\s+(\d{1,2})\/(\d{1,2})$/i.exec(s);
      if (m){
        const code = m[1].toLowerCase();
        const yy = parseInt(m[2],10);
        const month = pad2(parseInt(m[3],10));
        const day = pad2(parseInt(m[4],10));
        const year = 2000 + yy;
        return { pub: code + pad2(yy), issue: `${year}${month}${day}` };
      }
      m = /^([wg])(\d{2})\.(\d{2})$/i.exec(s);
      if (m){
        const code = m[1].toLowerCase();
        const yy = parseInt(m[2],10);
        const mm = pad2(parseInt(m[3],10));
        const year = 2000 + yy;
        return { pub: code + pad2(yy), issue: `${year}${mm}` };
      }
      return null;
    }

    function updateModeUI(){
  const bible = modeSwitch && modeSwitch.checked;
  const pubActive = !bible;
  const legend = document.querySelector('.switch-field.mode-group .legend');
  if (legend) legend.innerHTML = pubActive ? '<b>Publication</b> / Bible' : 'Publication / <b>Bible</b>';
  searchInput.placeholder = pubActive
    ? 'e.g. lff • w14 8/15 • w16.01'
    : 'e.g. Matthew 6:33 • Matthew 6 • 1 Peter 3:1-5';
  msgEl.textContent = '';
}
modeSwitch && modeSwitch.addEventListener('change', updateModeUI);
updateModeUI();

    function buildUrl(){
      const wtlocale = getSelectedLanguage();
      const raw = (searchInput.value||'').trim();
      if(!raw){ msgEl.textContent='Please enter a value.'; return null; }

      if (modeSwitch && modeSwitch.checked) {
        const code = parseBibleRef(raw);
        if(!code){ msgEl.textContent='Enter a valid Bible citation (e.g., Matthew 6:33 or Matthew 6:33-34 or Matthew 6).'; return null; }
        msgEl.textContent='';
        return `https://www.jw.org/finder?wtlocale=${wtlocale}&bible=${code}`;
      }

      const per = parsePeriodical(raw);
      if(per){ msgEl.textContent=''; return `https://www.jw.org/finder?wtlocale=${wtlocale}&pub=${encodeURIComponent(per.pub)}&issue=${encodeURIComponent(per.issue)}`; }

      msgEl.textContent='';
      return `https://www.jw.org/finder?wtlocale=${wtlocale}&pub=${encodeURIComponent(raw)}`;
    }

    function doSearch(){
      const url = buildUrl();
      if(!url) return;
      currentUrl = url;
      document.querySelector('.mode-group').style.display = 'none'; // hide mode button on search
      extraButtons.style.display = 'grid';
      findBtn.style.display='none';
      newSearchBtn.style.display='inline-block';
      qrContainer.style.display='none';
    }

    findBtn.addEventListener('click', doSearch);
    searchInput.addEventListener('keydown', e=>{ if(e.key==='Enter') doSearch(); });

    tocBtn.addEventListener('click', ()=>{ if(currentUrl) window.location.href=currentUrl; });

    qrBtn.addEventListener('click', ()=>{
      if(!currentUrl) return;
      qrContainer.style.display='block';
      new QRious({ element: qrCanvas, value: currentUrl, size: 150 });
    });

    shareBtn.addEventListener('click', async ()=>{
      if(!currentUrl) return;
      try{
        await navigator.clipboard.writeText(currentUrl);
        msgEl.style.color='#10b981';
        msgEl.textContent='Link copied to clipboard!';
        setTimeout(()=>{ msgEl.textContent=''; msgEl.style.color='#ef4444'; }, 1800);
      }catch{ msgEl.textContent='Failed to copy link.'; }
    });

    newSearchBtn.addEventListener('click', ()=>{
      searchInput.value=''; currentUrl=null; extraButtons.style.display='none'; findBtn.style.display='block'; msgEl.textContent=''; qrContainer.style.display='none';
      document.querySelector('.mode-group').style.display = 'flex'; // show mode button again
      searchInput.focus();
    });
  </script>
</body>
</html>
