<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pub Finder Util</title>
  <style>
    :root{
      --bg1:#6a11cb;--bg2:#2575fc;--card:rgba(255,255,255,.95);
      --text:#1f2937;--muted:#6b7280;--accent:#2563eb;--accent2:#0ea5e9;--radius:16px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      display:grid;place-items:center;padding:24px;
    }
    .card{
      width:min(720px,92vw);background:var(--card);border-radius:var(--radius);
      box-shadow:0 20px 40px rgba(0,0,0,.25);padding:clamp(16px,3vw,28px);
    }
    h1{margin:0 0 12px;font-size:clamp(20px,4vw,28px);color:var(--text);text-align:center}
    p.sub{margin:0 0 24px;color:var(--muted);text-align:center}
    .grid{display:grid;gap:12px;grid-template-columns:1fr 220px}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .field{display:grid;gap:8px}
    label{font-weight:600;color:var(--text)}
    input[type="text"]{
      width:100%;padding:14px 16px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;font-size:16px;
      outline:none;box-shadow:0 2px 0 rgba(0,0,0,.02) inset;
    }
    input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(37,99,235,.15)}
    .actions{display:grid;gap:10px;grid-template-columns:1fr;margin-top:10px}
    .btn{
      border:0;border-radius:12px;padding:14px 16px;font-size:16px;font-weight:600;cursor:pointer;
      background:var(--accent);color:#fff;transition:transform .05s ease,filter .2s ease;
    }
    .btn:hover{filter:brightness(.96)} .btn:active{transform:translateY(1px)}
    .btn.secondary{background:var(--accent2)}
    .hidden{display:none!important}
    .msg{min-height:22px;color:#dc2626;font-weight:600;margin-top:4px}
    .result{margin-top:14px;padding:12px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;font-family:ui-monospace,Menlo,Consolas,monospace;word-break:break-all}
    .qr-wrap{display:grid;place-items:center;margin-top:12px}
    #qrcode{background:#fff;padding:8px;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.12)}
    small.muted{color:var(--muted)}
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>Pub Finder Util</h1>
    <p class="sub">Build a JW.org finder link from a language code and mnemonic.</p>

    <div class="grid">
      <div class="field">
        <label for="langInput">Language (code or name)</label>
        <input id="langInput" list="langList" type="text" placeholder="Start typing e.g. English, ASL, Spanishâ€¦" autocomplete="on" />
        <datalist id="langList"></datalist>
        <small class="muted">Defaults to English (<b>En</b>). Uses site language codes (e.g., <b>En</b>, <b>Ase</b>).</small>
      </div>
      <div class="field">
        <label for="mnemonic">Mnemonic (pub)</label>
        <input id="mnemonic" type="text" placeholder="e.g. lff, lfb, nwtsty" />
      </div>
    </div>

    <div class="actions">
      <button id="searchBtn" class="btn">Search</button>
      <div id="postActions" class="hidden">
        <div class="actions">
          <button id="goBtn" class="btn">Go to Publication</button>
          <button id="qrBtn" class="btn secondary">Display QR Code</button>
          <button id="shareBtn" class="btn secondary">Share Link</button>
        </div>
      </div>
    </div>

    <div id="msg" class="msg" aria-live="polite"></div>
    <div id="result" class="result hidden"></div>
    <div id="qrSection" class="qr-wrap hidden"><div id="qrcode"></div></div>
  </main>

  <!-- Working QR generator -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // Prepopulated list (extend as needed). Keys = names typed; values = site codes (case matters).
    const LANGUAGE_MAP = {
      "English":"En","ASL":"Ase","Spanish":"Es","German":"De","French":"Fr","Portuguese":"Pt","Italian":"It",
      "Japanese":"Ja","Korean":"Ko","Chinese (Mandarin, Trad)":"Ch","Chinese (Cantonese, Trad)":"Chc",
      "Arabic":"A","Polish":"Pl","Russian":"Ru"
    };

    // Build datalist options (shows names; label hints at code in some UIs)
    const langList = document.getElementById("langList");
    Object.keys(LANGUAGE_MAP).sort().forEach(name=>{
      const opt=document.createElement("option");
      opt.value=name; opt.label=LANGUAGE_MAP[name];
      langList.appendChild(opt);
    });

    const langInput = document.getElementById("langInput");
    const mnemonicInput = document.getElementById("mnemonic");
    const msg = document.getElementById("msg");
    const result = document.getElementById("result");
    const postActions = document.getElementById("postActions");
    const searchBtn = document.getElementById("searchBtn");
    const goBtn = document.getElementById("goBtn");
    const qrBtn = document.getElementById("qrBtn");
    const shareBtn = document.getElementById("shareBtn");
    const qrSection = document.getElementById("qrSection");
    const qrNode = document.getElementById("qrcode");
    let qrInstance = null;

    // Default to English
    langInput.value = "English";

    function resolveLangCode(input){
      if(!input) return "En";
      const trimmed = input.trim();
      if(LANGUAGE_MAP[trimmed]) return LANGUAGE_MAP[trimmed];     // name -> code
      const maybeCode = trimmed.replace(/\\s+/g,'');               // typed a code directly
      if(maybeCode.length>=1 && maybeCode.length<=4){
        return maybeCode.charAt(0).toUpperCase()+maybeCode.slice(1).toLowerCase();
      }
      return "En";
    }

    function buildUrl(){
      const pub = (mnemonicInput.value||"").trim();
      if(!pub){ msg.textContent="Please enter a mnemonic (e.g., lff, lfb, nwtsty)."; return null; }
      const wtlocale = resolveLangCode(langInput.value);
      const url = `https://www.jw.org/finder?wtlocale=${encodeURIComponent(wtlocale)}&pub=${encodeURIComponent(pub)}`;
      msg.textContent = "";
      result.textContent = url;
      result.classList.remove("hidden");
      return url;
    }

    function revealPostActions(){ postActions.classList.remove("hidden"); }

    searchBtn.addEventListener("click", ()=>{
      const url = buildUrl();
      if(!url) return;
      revealPostActions();
      qrSection.classList.add("hidden");
      if(qrInstance){ qrNode.innerHTML=""; qrInstance=null; }
    });

    goBtn.addEventListener("click", ()=>{
      const url = buildUrl();
      if(url) window.location.href = url;
    });

    qrBtn.addEventListener("click", ()=>{
      const url = buildUrl();
      if(!url) return;
      qrNode.innerHTML="";
      qrInstance = new QRCode(qrNode, { text:url, width:196, height:196, correctLevel: QRCode.CorrectLevel.M });
      qrSection.classList.remove("hidden");
    });

    shareBtn.addEventListener("click", async ()=>{
      const url = buildUrl();
      if(!url) return;
      try{
        await navigator.clipboard.writeText(url);
        msg.style.color = "#16a34a";
        msg.textContent = "Link copied to clipboard!";
        setTimeout(()=>{ msg.textContent=""; msg.style.color="#dc2626"; }, 1800);
      }catch{ msg.textContent="Failed to copy link."; }
    });

    // Enter to Search
    [langInput, mnemonicInput].forEach(el=>el.addEventListener("keydown", e=>{
      if(e.key==="Enter") searchBtn.click();
    }));
  </script>
</body>
</html>
